(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{420:function(e,t,n){e.exports=n(699)},425:function(e,t,n){},524:function(e,t){},526:function(e,t){},537:function(e,t){},539:function(e,t){},566:function(e,t){},568:function(e,t){},569:function(e,t){},575:function(e,t){},577:function(e,t){},595:function(e,t){},597:function(e,t){},609:function(e,t){},612:function(e,t){},699:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(25),c=n.n(o),i=(n(425),n(89),n(406)),u=n(30),s=n(17),l=n(11),m=n(18),p=n(28),d=n(79),g=n(87),b=(n(103),n(258)),f=n.n(b),v=n(68),y=n.n(v);function h(e,t,n){var a={message:e,type:t},r=JSON.stringify(a),o=localStorage.getItem("".concat(n,"-privateKey"));return y.a.AES.encrypt(r,o).toString()}function O(e,t){var n=localStorage.getItem("".concat(t,"-privateKey")),a=y.a.AES.decrypt(e,n);return JSON.parse(a.toString(y.a.enc.Utf8))}function j(e,t){var n=new f.a;return n.setPublicKey(t.publicKey),n.encrypt(e)}function w(e){var t=new f.a;return t.setPrivateKey(localStorage.getItem("user-privateKey")),t.decrypt(e)}function E(){var e=Object(p.a)(["\n    subscription getNewGroups($username: String!){\n        newGroup(username: $username){\n          id\n          users{\n            username\n          }\n          name\n          publicKey\n          privateKey\n        }\n    }\n"]);return E=function(){return e},e}function S(){var e=Object(p.a)(["\n  query getGroupsWithUser($username: String!) {\n    groupsByUser(username: $username){\n      id\n      name\n      users {\n        username\n      }\n      privateKey\n    }\n  }\n"]);return S=function(){return e},e}var k=Object(l.gql)(S()),K=Object(l.gql)(E());var C=function(e){var t=e.selectedGroup,n=e.setSelectedGroup,o=e.setDoneFetching,c=e.client,i=localStorage.getItem("username"),u=Object(l.useQuery)(k,{variables:{username:i}}),s=u.subscribeToMore,m=u.loading,p=u.error,b=u.data,f=u.refetch;if(Object(a.useEffect)((function(){var e=s({document:K,variables:{username:i},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.newGroup;return localStorage.setItem("".concat(a.id,"-privateKey"),w(a.privateKey)),Object.assign({},e,{groupsByUser:[a].concat(Object(d.a)(e.groupsByUser))})}});return function(){e()}}),[s,i]),m)return"Loading...";if(p)return c.resetStore(),f(),"Error! ".concat(p.message);var v=function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);var a="#";for(n=0;n<3;n++){a+=("00"+(t>>8*n&255).toString(16)).substr(-2)}return a},y=b.groupsByUser.map((function(e){null!=localStorage.getItem("".concat(e.id,"-privateKey"))&&"undefined"!==localStorage.getItem("".concat(e.id,"-privateKey"))||localStorage.setItem("".concat(e.id,"-privateKey"),w(e.privateKey));var n=e.users.map((function(e){return"@".concat(e.username)}));return{letterItem:{letter:e.name.charAt(0).toUpperCase(),id:v(e.name)},alt:e.name,title:e.name,subtitle:n.join(", "),date:new Date,unread:0,id:e.id,className:t===e.id?"activeChatLeft":"notActiveChatLeft"}}));return r.a.createElement(g.ChatList,{onClick:function(e){n(e.id),o(!1)},style:{backgroundColor:"#121212"},dataSource:y})},I=n(138),$=n(256),x=n.n($),M=(n(647),n(159),n(394)),T=function(e,t,n,a){if(null!=e.target.files){var r=new FileReader;r.readAsDataURL(e.target.files[0]),r.onload=function(o){var c=e.target.files[0].type.includes("image/")?"photo":"file",i=function(e,t,n){var a={content:e,filename:t},r=JSON.stringify(a),o=localStorage.getItem("".concat(n,"-privateKey"));return y.a.AES.encrypt(r,o).toString()}(r.result,e.target.files[0].name,t);n({variables:{username:a,gid:t,content:i,cType:c}})}}};function B(){var e=Object(p.a)(["\n  display: block;\n  margin: 0 auto;\n  border-color: red;\n"]);return B=function(){return e},e}Object(I.css)(B());var G=function(e){var t=e.messages,n=e.onLoadMore,o=(e.doneFetching,e.selectedGroup,r.a.createRef()),c=r.a.createRef();window.lm=n,Object(a.useEffect)((function(){o.scrollIntoView({behavior:"smooth"});var e=setInterval((function(){if(!c)return!1;var e=c.getBoundingClientRect().top;e+0>=0&&window.innerHeight}),1e3);return function(){clearInterval(e)}}),[n,c,o]),window.innerHeight;var i=localStorage.getItem("username"),u=t.map((function(e){return"text"===e.cType?{position:e.sender===i?"right":"left",type:"text",text:e.message.message,title:e.senderName,date:new Date(parseInt(e.ts))}:"photo"===e.cType?{position:e.sender===i?"right":"left",type:"photo",title:e.senderName,date:new Date(parseInt(e.ts)),data:{uri:e.message.content,filename:e.message.filename,status:{click:!1,loading:0},width:"300px",height:"150px"}}:"file"===e.cType?{position:e.sender===i?"right":"left",type:"file",text:e.message.filename,title:e.senderName,date:new Date(parseInt(e.ts)),data:{uri:e.message.content,status:{click:!1,loading:0}}}:null})).filter(Boolean);return r.a.createElement("div",{style:{marginLeft:5,marginRight:5,marginBottom:50}},r.a.createElement("div",{style:{height:30},ref:function(e){c=e}}),r.a.createElement("div",{style:{}},r.a.createElement(g.MessageList,{className:"message-list",lockable:!0,toBottomHeight:"86%",onDownload:function(e){!function(e,t){for(var n=e.split(","),a=n[0].match(/:(.*?);/)[1],r=atob(n[1]),o=r.length,c=new Uint8Array(o);o--;)c[o]=r.charCodeAt(o);var i=new File([c],t,{type:a});Object(M.saveAs)(i,t)}(e.data.uri,"photo"===e.type?e.data.filename:e.text)},dataSource:u})),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(e){o=e}}))};function A(){var e=Object(p.a)(["\n  display: block;\n  margin: 0 auto;\n  border-color: red;\n"]);return A=function(){return e},e}function N(){var e=Object(p.a)(["\n    subscription getNewMessages($gid: Int!){\n        newMessage(gid: $gid){\n            id\n            content\n            ts\n            sender\n            group\n            cType\n        }\n    }\n"]);return N=function(){return e},e}function q(){var e=Object(p.a)(["\n    query getMessagesForGroup($gid: Int!, $offset: Int, $limit: Int) {\n        messagesByGroup(gid: $gid, count: $limit, offset: $offset){\n            id\n            content\n            ts\n            sender\n            group\n            cType\n        }\n    }\n"]);return q=function(){return e},e}var P=Object(l.gql)(q()),L=Object(l.gql)(N()),U=Object(I.css)(A());var D=function(e){var t=e.selectedGroup,n=e.doneFetching,o=e.setDoneFetching,c=Object(a.useState)([]),i=Object(m.a)(c,2),u=i[0],s=i[1],p=Object(l.useQuery)(P,{variables:{gid:t,offset:0,limit:50},fetchPolicy:"network"}),g=p.subscribeToMore,b=p.loading,f=p.error,v=p.data,y=p.fetchMore;return Object(a.useEffect)((function(){localStorage.getItem("username");if(v){var e=[].concat(v.messagesByGroup).reverse().map((function(e){return null==localStorage.getItem("".concat(t,"-privateKey"))||"undefined"===localStorage.getItem("".concat(t,"-privateKey"))?null:{sender:e.sender,message:O(e.content,t),senderName:"@".concat(e.sender),cType:e.cType,ts:e.ts}})).filter(Boolean);s(e)}var n=g({document:L,variables:{gid:t},updateQuery:function(e,n){var a=n.subscriptionData;if(!a.data)return o(!0),e;var r=a.data.newMessage,c={sender:r.sender,message:O(r.content,t),senderName:"@".concat(r.sender),cType:r.cType,ts:r.ts};return s((function(e){return[].concat(Object(d.a)(e),[c])})),Object.assign({},e,{messagesByGroup:[r].concat(Object(d.a)(e.messagesByGroup))})}});return function(){n()}}),[g,t,v]),b?r.a.createElement("div",{style:{marginLeft:"10px",marginRight:"10px",marginBottom:"50px"}},r.a.createElement("div",{style:{height:"30px"}},!n&&r.a.createElement(x.a,{css:U,size:30,color:"#123abc",loading:!0}))):f?"Error! ".concat(f.message):r.a.createElement(G,{messages:u,selectedGroup:t,doneFetching:n,onLoadMore:function(){if(!n)return y({variables:{offset:v.messagesByGroup.length},updateQuery:function(e,n){var a=n.fetchMoreResult;0===a.messagesByGroup.length&&o(!0);var r=a.messagesByGroup,c=(localStorage.getItem("username"),r.map((function(e){return null==localStorage.getItem("".concat(t,"-privateKey"))||"undefined"===localStorage.getItem("".concat(t,"-privateKey"))?null:{sender:e.sender,message:O(e.content,t),senderName:"@".concat(e.sender),cType:e.cType,ts:e.ts}})).filter(Boolean));return s((function(e){return[].concat(Object(d.a)(e),Object(d.a)(c))})),Object.assign({},e,{messagesByGroup:[].concat(Object(d.a)(e.messagesByGroup),Object(d.a)(a.messagesByGroup))})}})}})},F=n(69),R=n(408),z=n(36),H=n(184),W=n.n(H),J=(n(347),n(42)),Q=n.n(J),V=n(77),Y=n(176),X=n.n(Y);function Z(e){return String.fromCharCode.apply(null,Array.from(new Uint8Array(e)))}function _(e){return ee.apply(this,arguments)}function ee(){return(ee=Object(V.a)(Q.a.mark((function e(t){var n,a,r,o;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.exportKey("spki",t);case 2:return n=e.sent,a=Z(n),r=window.btoa(a),o="-----BEGIN PUBLIC KEY-----\n".concat(r,"\n-----END PUBLIC KEY-----"),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return ne.apply(this,arguments)}function ne(){return(ne=Object(V.a)(Q.a.mark((function e(t){var n,a,r,o;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.exportKey("pkcs8",t);case 2:return n=e.sent,a=Z(n),r=window.btoa(a),o="-----BEGIN PRIVATE KEY-----\n".concat(r,"\n-----END PRIVATE KEY-----"),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e,t){return re.apply(this,arguments)}function re(){return(re=Object(V.a)(Q.a.mark((function e(t,n){var a;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:n,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]).then(function(){var e=Object(V.a)(Q.a.mark((function e(n){var a,r;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(n.publicKey);case 2:return a=e.sent,e.next=5,te(n.privateKey);case 5:return r=e.sent,e.abrupt("return",{privateKey:r,username:t,publicKey:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e){return X.a.pbkdf2Sync(e,"salt",1,32,"sha512").toString("hex")}function ce(){var e=JSON.stringify(localStorage),t=localStorage.getItem("password")||"";return y.a.AES.encrypt(e,t).toString()}function ie(e,t){var n=y.a.AES.decrypt(e,t);try{for(var a=JSON.parse(n.toString(y.a.enc.Utf8)),r=0,o=Object.entries(a);r<o.length;r++){var c=Object(m.a)(o[r],2),i=c[0],u=c[1];localStorage.setItem(i,u)}}catch(s){return console.error(s),!1}return!0}var ue=n(59),se=n(144);function le(){var e=Object(p.a)(["\n    mutation updateKeys($username: String!, $keys: String!){\n        updateKeys(username:$username, keys:$keys){\n            success\n        }\n    }\n"]);return le=function(){return e},e}function me(){var e=Object(p.a)(["\n    mutation createPrivateKey($username: String!, $privateKey: String!, $gid: Int!){\n        createPrivateKey(username:$username, gid:$gid, privateKey:$privateKey){\n            id\n            privateKey\n        }\n    }\n"]);return me=function(){return e},e}function pe(){var e=Object(p.a)(["\nmutation createGroup($name: String!, $publicKey: String!, $users: [String!]){\n    createGroup(name:$name, publicKey:$publicKey, users:$users){\n      id\n      name\n      publicKey\n      users{\n          username\n          publicKey\n      }\n    }\n  }\n"]);return pe=function(){return e},e}var de=Object(l.gql)(pe()),ge=Object(l.gql)(me()),be=Object(l.gql)(le());var fe=function(e){var t=e.show,n=e.setShow,o=Object(a.useState)([]),c=Object(m.a)(o,2),i=c[0],u=c[1],s=function(){return n(!1)},p=Object(a.useState)(""),d=Object(m.a)(p,2),g=d[0],b=d[1],f=Object(l.useMutation)(be),v=Object(m.a)(f,1)[0],y=Object(l.useMutation)(ge),h=Object(m.a)(y,1)[0],O=Object(l.useMutation)(de,{onCompleted:function(e){var t=e.createGroup,n=localStorage.getItem("username"),a=localStorage.getItem("temp-group-privatekey");localStorage.setItem("".concat(t.id,"-privateKey"),a),localStorage.removeItem("temp-group-privatekey"),t.users.map((function(e){var n=j(a,e);return h({variables:{username:e.username,gid:t.id,privateKey:n}}),!0})),v({variables:{username:n,keys:ce()}}),s()}}),w=Object(m.a)(O,1)[0];return r.a.createElement("div",{style:{backgroundColor:"#2e2e2e"}},r.a.createElement(ue.a,{show:t,transparent:"true",onHide:s},r.a.createElement(ue.a.Header,{closeButton:!0,style:{backgroundColor:"#2e2e2e",borderColor:"#2e2e2e"}},r.a.createElement(ue.a.Title,null,"Input the individuals to add to your new Group Chat!")),r.a.createElement(ue.a.Body,{style:{backgroundColor:"#2e2e2e",borderColor:"#2e2e2e"}},r.a.createElement(W.a,{style:{color:"white"},value:i,onChange:function(e){return u(e)},inputProps:{className:"react-tagsinput-input",placeholder:"Add people!"},onlyUnique:!0}),r.a.createElement(se.a,{style:{marginTop:"20px"}},r.a.createElement(se.a.Group,null,r.a.createElement(se.a.Control,{testid:"createGroupInputField",style:{color:"black"},type:"text",placeholder:"Group Name",value:g,onChange:function(e){return b(e.target.value)}})))),r.a.createElement(ue.a.Footer,{style:{backgroundColor:"#2e2e2e",borderColor:"#2e2e2e"}},r.a.createElement(F.a,{variant:"secondary",onClick:s},"Close"),r.a.createElement(F.a,{variant:"primary",onClick:function(){return function(e,t){e.push(localStorage.getItem("username"));var n=e.filter((function(e,t,n){return n.indexOf(e)===t}));n&&n.length>0&&Promise.resolve(ae(t,256)).then((function(e){var a=e.publicKey,r=e.privateKey;localStorage.setItem("temp-group-privatekey",r),w({variables:{users:n,publicKey:a,name:t}})}))}(i,g)}},"Create Group!"))))};function ve(){var e=Object(p.a)(["\n    mutation updateKeys($username: String!, $keys: String!){\n        updateKeys(username:$username, keys:$keys){\n            success\n        }\n    }\n"]);return ve=function(){return e},e}function ye(){var e=Object(p.a)(["\n    mutation createPrivateKey($username: String!, $privateKey: String!, $gid: Int!){\n        createPrivateKey(username:$username, gid:$gid, privateKey:$privateKey){\n            id\n            privateKey\n        }\n    }\n"]);return ye=function(){return e},e}function he(){var e=Object(p.a)(["\nmutation addMemberToGroup($gid: Int!, $users: [String!]){\n    addGroupMember(gid:$gid, users:$users){\n      id\n      name\n      publicKey\n      users{\n          username\n          publicKey\n      }\n    }\n  }\n"]);return he=function(){return e},e}var Oe=Object(l.gql)(he()),je=Object(l.gql)(ye()),we=Object(l.gql)(ve());var Ee=function(e){var t=e.show,n=e.setShow,o=e.groupId,c=Object(a.useState)([]),i=Object(m.a)(c,2),u=i[0],s=i[1],p=function(){return n(!1)},d=Object(a.useState)(""),g=Object(m.a)(d,2),b=(g[0],g[1],Object(l.useMutation)(we)),f=Object(m.a)(b,1)[0],v=Object(l.useMutation)(je),y=Object(m.a)(v,1)[0],h=Object(l.useMutation)(Oe,{onCompleted:function(e){var t=e.addGroupMember,n=localStorage.getItem("username"),a=localStorage.getItem("".concat(t.id,"-privateKey"));t.users.map((function(e){var n=j(a,e);return y({variables:{username:e.username,gid:t.id,privateKey:n}}),!0})),f({variables:{username:n,keys:ce()}}),p()}}),O=Object(m.a)(h,1)[0];return r.a.createElement("div",{style:{backgroundColor:"#2e2e2e"}},r.a.createElement(ue.a,{show:t,transparent:"true",onHide:p},r.a.createElement(ue.a.Header,{closeButton:!0,style:{backgroundColor:"#2e2e2e",borderColor:"#2e2e2e"}},r.a.createElement(ue.a.Title,null,"Input the individuals to add to your this group!")),r.a.createElement(ue.a.Body,{style:{backgroundColor:"#2e2e2e",borderColor:"#2e2e2e"}},r.a.createElement(W.a,{style:{color:"white"},value:u,onChange:function(e){return s(e)},inputProps:{className:"react-tagsinput-input",placeholder:"Add people!"},onlyUnique:!0})),r.a.createElement(ue.a.Footer,{style:{backgroundColor:"#2e2e2e",borderColor:"#2e2e2e"}},r.a.createElement(F.a,{variant:"secondary",onClick:p},"Close"),r.a.createElement(F.a,{variant:"primary",onClick:function(){return function(e){var t=e.filter((function(e,t,n){return n.indexOf(e)===t}));t&&t.length>0&&O({variables:{users:t,gid:parseInt(o)}})}(u)}},"Add Members!"))))};function Se(){var e=Object(p.a)(["\n    mutation SendMessage($username: String!, $content: String!, $gid: Int!, $cType: String!){\n        createMessage(sender:$username, group:$gid, content:$content, cType:$cType){\n            id\n            content\n            ts\n        }\n    }\n"]);return Se=function(){return e},e}var ke=Object(l.gql)(Se()),Ke={defaultTheme:{FixedWrapperMaximized:{css:{boxShadow:"0 0 1em rgba(0, 0, 0, 0.1)"}},OwnMessage:Object(s.a)(Object(s.a)({},z.c.OwnMessage),{},{backgroundColor:"#456456",secondaryTextColor:"#456456"})},purpleTheme:Object(s.a)(Object(s.a)({},z.e),{},{TextComposer:Object(s.a)(Object(s.a)({},z.e.TextComposer),{},{css:Object(s.a)(Object(s.a)({},z.e.TextComposer.css),{},{marginTop:"1em"})}),OwnMessage:Object(s.a)(Object(s.a)({},z.e.OwnMessage),{},{secondaryTextColor:"#fff"})}),elegantTheme:Object(s.a)(Object(s.a)({},z.d),{},{Message:Object(s.a)(Object(s.a)({},z.b.Message),{},{secondaryTextColor:"#fff"}),OwnMessage:Object(s.a)(Object(s.a)({},z.b.OwnMessage),{},{secondaryTextColor:"#fff"})}),darkTheme:Object(s.a)(Object(s.a)({},z.b),{},{vars:Object(s.a)(Object(s.a)({},z.b.vars),{},{"tertiary-color":"rgba(40, 40, 40, 0.8)"}),Message:Object(s.a)(Object(s.a)({},z.b.Message),{},{css:Object(s.a)(Object(s.a)({},z.b.Message.css),{},{color:"#fff"})}),OwnMessage:Object(s.a)(Object(s.a)({},z.b.OwnMessage),{},{secondaryTextColor:"#fff"}),TitleBar:Object(s.a)(Object(s.a)({},z.b.TitleBar),{},{css:Object(s.a)(Object(s.a)({},z.b.TitleBar.css),{},{padding:"1em"})})})};var Ce=function(e){var t=e.client,n=Object(a.useRef)(null),o=Object(a.useRef)(null),c=localStorage.getItem("username"),i=Object(a.useState)(""),u=Object(m.a)(i,2),s=(u[0],u[1],Object(l.useMutation)(ke)),p=Object(m.a)(s,1)[0],d=Object(a.useState)(null),b=Object(m.a)(d,2),f=b[0],v=b[1],y=Object(a.useState)(!1),O=Object(m.a)(y,2),j=O[0],w=O[1],E=Object(a.useState)(!1),S=Object(m.a)(E,2),k=S[0],K=S[1],I=Object(a.useState)(!1),$=Object(m.a)(I,2),x=$[0],M=$[1];return r.a.createElement("div",{className:"main"},r.a.createElement(fe,{show:k,setShow:K}),r.a.createElement(Ee,{show:x,setShow:M,groupId:f}),r.a.createElement(z.a,{theme:Ke.darkTheme},r.a.createElement("div",{style:{height:"100%",width:"30%",position:"fixed",zIndex:1,top:0,overflowX:"hidden",paddingTop:"20px",left:0}},r.a.createElement("div",{style:{verticalAlign:"middle",fontSize:24}},r.a.createElement(R.a,{name:c,size:50,round:!0,style:{marginBottom:20,marginLeft:25},title:"@".concat(c)})," ","@".concat(c)),r.a.createElement("div",{className:"App",style:{marginBottom:10}},f&&r.a.createElement(F.a,{variant:"primary",style:{marginRight:"10px"},onClick:function(){return M(!x)}},"Add Member to Chat"),r.a.createElement(F.a,{variant:"primary",style:{marginRight:"10px"},onClick:function(){return K(!k)}},"Create Group Chat"),r.a.createElement(F.a,{variant:"secondary",onClick:function(){localStorage.clear();var e=window.location.href.split("/");e.pop();var t=e.join("/");window.location.href=t}},"Logout")),r.a.createElement(C,{client:t,selectedGroup:f,setSelectedGroup:v,setDoneFetching:w})),r.a.createElement("div",{style:{height:"100%",width:"70%",position:"fixed",zIndex:1,top:0,overflowX:"hidden",right:0,borderLeft:"1px solid white"}},f&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{styles:{overflow:"hidden"}},r.a.createElement("div",{style:{height:"90%",position:"relative"}},r.a.createElement(D,{selectedGroup:f,doneFetching:j,setDoneFetching:w})),r.a.createElement("div",{style:{paddingLeft:"1px",height:"5%",bottom:"1%",position:"fixed",width:"68%"}},r.a.createElement(g.Input,{placeholder:"Enter message",defaultValue:"",ref:n,multiline:!0,onKeyPress:function(e){return!(!e.shiftKey||13!==e.charCode)||(13===e.charCode&&""!==n.current.input.value.trim()?(p({variables:{username:c,gid:f,content:h(n.current.input.value,"text",f),cType:"text"}}),n.current.clear(),e.preventDefault(),!1):void 0)},rightButtons:r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{id:"raised-button-file",style:{display:"none"},type:"file",ref:o,onChange:function(e,t){T(e,f,p,c),e.preventDefault()}}),r.a.createElement(g.Button,{text:"Upload",onClick:function(){o.current.click()}}),r.a.createElement(g.Button,{text:"Send",onClick:function(e){""!==n.current.input.value.trim()&&(p({variables:{username:c,gid:f,content:h(n.current.input.value,"text",f),cType:"text"}}),n.current.clear(),e.preventDefault())}}))})))))))},Ie=n(187),$e=n(4),xe=n(188);var Me=function(){var e=window.location.href.includes("https://rithik.me/"),t=e?"https://e2-chat.herokuapp.com":"http://localhost:4000",n=e?"wss://e2-chat.herokuapp.com":"ws://localhost:4000",a=localStorage.getItem("token"),o=Object(l.createHttpLink)({uri:"".concat(t,"/graphql")}),c=Object(Ie.a)((function(e,t){var n=t.headers;return{headers:Object(s.a)(Object(s.a)({},n),{},{authorization:a?"".concat(a):""})}})),i=new xe.a({uri:"".concat(n,"/graphql"),options:{reconnect:!0,connectionParams:{Authorization:a}}}),u=Object(l.split)((function(e){var t=e.query,n=Object($e.p)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),i,c.concat(o)),m=new l.ApolloClient({link:u,cache:new l.InMemoryCache});return r.a.createElement(l.ApolloProvider,{client:m},r.a.createElement("div",null,r.a.createElement(Ce,{client:m})))},Te=n(734),Be=n(738),Ge=n(739),Ae=n(737),Ne=n(736),qe=n(263),Pe=n.n(qe),Le=n(409),Ue=n(262),De=n(735),Fe=n(407),Re=n(730);function ze(){var e=Object(p.a)(["\n    mutation updateKeys($username: String!, $keys: String!){\n        updateKeys(username:$username, keys:$keys){\n            success\n        }\n    }\n"]);return ze=function(){return e},e}function He(){var e=Object(p.a)(["\n\tquery User($username: String!){\n\t\tuser(username:$username){\n\t\t\tusername\n\t\t\tid\n\t\t\tkeys\n\t\t}\n\t}\n"]);return He=function(){return e},e}function We(){var e=Object(p.a)(["\n\tmutation CreateToken($username: String!, $publicKey: String!){\n\t\t  createToken(username:$username, publicKey:$publicKey){\n\t\t    token\n\t\t    username\n\t\t}\n\t}\n"]);return We=function(){return e},e}function Je(){var e=Object(p.a)(["\n\tmutation CreateUser($username: String!, $publicKey: String!){\n\t  createUser(username:$username, publicKey:$publicKey){\n\t    id\n\t    username\n\t    publicKey\n\t  }\n\t}\n"]);return Je=function(){return e},e}var Qe=Object(Fe.a)({overrides:{MuiFormLabel:{root:{color:"white",borderColor:"white"}},MuiOutlinedInput:{root:{"& $notchedOutline":{borderColor:"rgba(255, 255, 255, 0.23)"},"&:hover:not($disabled):not($focused):not($error) $notchedOutline":{borderColor:"#4A90E2","@media (hover: none)":{borderColor:"rgba(255, 255, 255, 0.23)"}},"&$focused $notchedOutline":{borderColor:"#4A90E2",borderWidth:1}}},MuiInput:{input:{"&::placeholder":{color:"gray"},color:"white"}}}}),Ve=Object(l.gql)(Je()),Ye=Object(l.gql)(We()),Xe=Object(l.gql)(He()),Ze=Object(l.gql)(ze());var _e=function(){var e=Object(l.useMutation)(Ze),t=Object(m.a)(e,1)[0],n=Object(l.useMutation)(Ve,{onCompleted:function(e){var t=e.createUser,n=t.username,a=t.publicKey;i({variables:{username:n,publicKey:a}})}}),o=Object(m.a)(n,1)[0],c=Object(l.useMutation)(Ye,{onCompleted:function(e){var n=e.createToken,a="login"===F?K:y;localStorage.setItem("token",n.token),localStorage.setItem("username",n.username),localStorage.setItem("password",oe(a)),t({variables:{username:n.username,keys:ce()}}),window.location.href=window.location.href+"main"}}),i=Object(m.a)(c,1)[0],u=Object(l.useMutation)(Ye,{onCompleted:function(e){var t=e.createToken;localStorage.setItem("token",t.token),window.location.href=window.location.href+"main"}}),s=Object(m.a)(u,1)[0],p=Object(a.useState)(""),d=Object(m.a)(p,2),g=d[0],b=d[1],f=Object(a.useState)(""),v=Object(m.a)(f,2),y=v[0],h=v[1],O=Object(a.useState)(""),j=Object(m.a)(O,2),w=j[0],E=j[1],S=Object(a.useState)(""),k=Object(m.a)(S,2),K=k[0],C=k[1],I=Object(a.useState)(!1),$=Object(m.a)(I,2),x=$[0],M=$[1],T=Object(a.useState)(!1),B=Object(m.a)(T,2),G=B[0],A=B[1],N=Object(a.useState)(!1),q=Object(m.a)(N,2),P=q[0],L=q[1],U=Object(a.useState)("login"),D=Object(m.a)(U,2),F=D[0],R=D[1],z=Object(l.useQuery)(Xe,{variables:{username:"login"===F?w:g}}),H=z.error,W=z.refetch,J=function(){var e=Object(V.a)(Q.a.mark((function e(t){var n;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="login"===F?w:g,Promise.resolve(ae(t,4096)).then((function(e){var t=e.publicKey,a=e.privateKey;o({variables:{username:n,publicKey:t}}),localStorage.setItem("user-publicKey",t),localStorage.setItem("user-privateKey",a),localStorage.setItem("username",n)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=function(){var e=Object(V.a)(Q.a.mark((function e(){var t,n;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W({username:g});case 2:t=e.sent,n=t.data,H?J(g):null==n.user?(M(!1),J(g)):(M(!0),L(!1));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=Object(V.a)(Q.a.mark((function e(){var t,n,a,r,o;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W({username:w});case 2:t=e.sent,n=t.data,H?(console.error(H),A(!0),L(!1)):null===n.user?(A(!0),L(!1)):(a=oe(K),ie(n.user.keys,a)?(r=localStorage.getItem("username"),o=localStorage.getItem("user-publicKey"),s({variables:{username:r,publicKey:o}})):(A(!0),L(!1)));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(Re.a,{theme:Qe},r.a.createElement(Le.a,{fill:!0,id:"controlled-tab-example",className:"tabHeadings",activeKey:F,onSelect:function(e){return R(e)}},r.a.createElement(Ue.a,{eventKey:"login",title:"Login"},r.a.createElement("div",{className:"register"},r.a.createElement(Be.a,{InputProps:{style:{color:"white"}},id:"outlined-basic",label:"Username",variant:"outlined",value:w,color:"secondary",fullWidth:!0,onChange:function(e){return E(e.target.value)}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Be.a,{InputProps:{style:{color:"white"}},id:"outlined-basic",label:"Password",variant:"outlined",value:K,type:"password",color:"secondary",fullWidth:!0,onChange:function(e){return C(e.target.value)}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Te.a,{disabled:P,onClick:function(e){e.preventDefault(),L(!0),X()},variant:"contained",color:"secondary"},P&&r.a.createElement(De.a,{size:20,style:{color:"white",marginRight:"10px"}})," Login"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Ne.a,{in:G},r.a.createElement(Ge.a,{action:r.a.createElement(Ae.a,{"aria-label":"close",color:"inherit",size:"small",onClick:function(){A(!1)}},r.a.createElement(Pe.a,{fontSize:"inherit"})),variant:"filled",severity:"error"},"Invalid Login")))),r.a.createElement(Ue.a,{eventKey:"register",title:"Register"},r.a.createElement("div",{className:"register"},r.a.createElement(Be.a,{InputProps:{style:{color:"white"}},id:"outlined-basic",label:"Username",variant:"outlined",value:g,color:"secondary",fullWidth:!0,onChange:function(e){return b(e.target.value)}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Be.a,{InputProps:{style:{color:"white"}},id:"outlined-basic",label:"Password",variant:"outlined",value:y,type:"password",color:"secondary",fullWidth:!0,onChange:function(e){return h(e.target.value)}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Te.a,{disabled:P,onClick:function(e){e.preventDefault(),L(!0),Y()},variant:"contained",color:"secondary"},P&&r.a.createElement(De.a,{size:20,style:{color:"white",marginRight:"10px"}})," Register"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Ne.a,{in:x},r.a.createElement(Ge.a,{action:r.a.createElement(Ae.a,{"aria-label":"close",color:"inherit",size:"small",onClick:function(){M(!1)}},r.a.createElement(Pe.a,{fontSize:"inherit"})),variant:"filled",severity:"error"},"Invalid username - choose a unique username"))))))};var et=function(){var e=window.location.href.includes("https://rithik.me/"),t=e?"https://e2-chat.herokuapp.com":"http://localhost:4000",n=e?"wss://e2-chat.herokuapp.com":"ws://localhost:4000",a=localStorage.getItem("token"),o=Object(l.createHttpLink)({uri:"".concat(t,"/graphql")}),c=Object(Ie.a)((function(e,t){var n=t.headers;return{headers:Object(s.a)(Object(s.a)({},n),{},{authorization:a?"".concat(a):""})}})),i=new xe.a({uri:"".concat(n,"/graphql"),options:{reconnect:!0,connectionParams:{Authorization:a}}}),u=Object(l.split)((function(e){var t=e.query,n=Object($e.p)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),i,c.concat(o)),m=new l.ApolloClient({link:u,cache:new l.InMemoryCache});return r.a.createElement(l.ApolloProvider,{client:m},r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement(_e,null))))};var tt=function(){return r.a.createElement(i.a,{basename:"/"},r.a.createElement(u.c,null,r.a.createElement(u.a,{path:"/main"},r.a.createElement(Me,null)),r.a.createElement(u.a,{path:"/"},r.a.createElement(et,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.Fragment,null,r.a.createElement(tt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},89:function(e,t,n){}},[[420,1,2]]]);
//# sourceMappingURL=main.f384bd50.chunk.js.map