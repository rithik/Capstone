(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{420:function(e,t,n){e.exports=n(699)},425:function(e,t,n){},524:function(e,t){},526:function(e,t){},537:function(e,t){},539:function(e,t){},566:function(e,t){},568:function(e,t){},569:function(e,t){},575:function(e,t){},577:function(e,t){},595:function(e,t){},597:function(e,t){},609:function(e,t){},612:function(e,t){},699:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(25),c=n.n(o),i=(n(425),n(86),n(406)),s=n(29),l=n(17),u=n(15),m=n(23),p=n(32),d=n(77),g=n(35),f=n(109),b=(n(100),n(259)),v=n.n(b),y=n(67),h=n.n(y);function O(e,t,n){var a={message:e,type:t},r=JSON.stringify(a),o=localStorage.getItem("".concat(n,"-privateKey"));return h.a.AES.encrypt(r,o).toString()}function j(e,t){var n=localStorage.getItem("".concat(t,"-privateKey")),a=h.a.AES.decrypt(e,n);return JSON.parse(a.toString(h.a.enc.Utf8))}function w(e){var t=new v.a;return t.setPrivateKey(localStorage.getItem("user-privateKey")),t.decrypt(e)}function E(){var e=Object(p.a)(["\n    subscription getNewGroups($username: String!){\n        newGroup(username: $username){\n          id\n          users{\n            username\n          }\n          name\n          publicKey\n          privateKey\n        }\n    }\n"]);return E=function(){return e},e}function S(){var e=Object(p.a)(["\n  query getGroupsWithUser($username: String!) {\n    groupsByUser(username: $username){\n      id\n      name\n      users {\n        username\n      }\n      privateKey\n    }\n  }\n"]);return S=function(){return e},e}var k=Object(u.gql)(S()),K=Object(u.gql)(E());var I=function(e){var t=e.selectedGroup,n=e.setSelectedGroup,o=e.setDoneFetching,c=e.client,i=localStorage.getItem("username"),s=Object(u.useQuery)(k,{variables:{username:i}}),l=s.subscribeToMore,m=s.loading,p=s.error,g=s.data,b=s.refetch;if(Object(a.useEffect)((function(){var e=l({document:K,variables:{username:i},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.newGroup;return localStorage.setItem("".concat(a.id,"-privateKey"),w(a.privateKey)),Object.assign({},e,{groupsByUser:[a].concat(Object(d.a)(e.groupsByUser))})}});return function(){e()}}),[l,i]),m)return"Loading...";if(p)return c.resetStore(),b(),"Error! ".concat(p.message);var v=function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);var a="#";for(n=0;n<3;n++){a+=("00"+(t>>8*n&255).toString(16)).substr(-2)}return a},y=g.groupsByUser.map((function(e){null!=localStorage.getItem("".concat(e.id,"-privateKey"))&&"undefined"!==localStorage.getItem("".concat(e.id,"-privateKey"))||localStorage.setItem("".concat(e.id,"-privateKey"),w(e.privateKey));var n=e.users.map((function(e){return"@".concat(e.username)}));return{letterItem:{letter:e.name.charAt(0).toUpperCase(),id:v(e.name)},alt:e.name,title:e.name,subtitle:n.join(", "),date:new Date,unread:0,id:e.id,className:t===e.id?"activeChatLeft":"notActiveChatLeft"}}));return console.log(y),r.a.createElement(f.ChatList,{onClick:function(e){console.log(e),n(e.id),o(!1)},style:{backgroundColor:"#121212"},dataSource:y})},C=n(138),$=n(255),x=n.n($),T=(n(343),n(231),n(400)),M=function(e,t,n,a){if(console.log(e.target.files[0]),null!=e.target.files){var r=new FileReader;r.readAsDataURL(e.target.files[0]),r.onload=function(o){var c=e.target.files[0].type.includes("image/")?"photo":"file",i=function(e,t,n){console.log(e);var a={content:e,filename:t},r=JSON.stringify(a),o=localStorage.getItem("".concat(n,"-privateKey"));return h.a.AES.encrypt(r,o).toString()}(r.result,e.target.files[0].name,t);n({variables:{username:a,gid:t,content:i,cType:c}})}}};function B(){var e=Object(p.a)(["\n  display: block;\n  margin: 0 auto;\n  border-color: red;\n"]);return B=function(){return e},e}Object(C.css)(B());var G=function(e){var t=e.messages,n=e.onLoadMore,o=(e.doneFetching,e.selectedGroup,r.a.createRef()),c=r.a.createRef();window.lm=n,Object(a.useEffect)((function(){o.scrollIntoView({behavior:"smooth"});var e=setInterval((function(){if(!c)return!1;var e=c.getBoundingClientRect().top;e+0>=0&&window.innerHeight}),1e3);return function(){clearInterval(e)}}),[n,c,o]);var i=.86*window.innerHeight,s=localStorage.getItem("username"),l=t.map((function(e){return console.log(e),"text"===e.cType?{position:e.sender===s?"right":"left",type:"text",text:e.message.message,title:e.senderName,date:new Date(parseInt(e.ts))}:"photo"===e.cType?{position:e.sender===s?"right":"left",type:"photo",title:e.senderName,date:new Date(parseInt(e.ts)),data:{uri:e.message.content,filename:e.message.filename,status:{click:!1,loading:0},width:"300px",height:"150px"}}:"file"===e.cType?{position:e.sender===s?"right":"left",type:"file",text:e.message.filename,title:e.senderName,date:new Date(parseInt(e.ts)),data:{uri:e.message.content,status:{click:!1,loading:0}}}:null})).filter(Boolean);return r.a.createElement("div",{style:{marginLeft:5,marginRight:5,marginBottom:50}},r.a.createElement("div",{style:{height:30},ref:function(e){c=e}}),r.a.createElement("div",{style:{maxHeight:i}},r.a.createElement(f.MessageList,{className:"message-list",lockable:!0,toBottomHeight:"86%",onDownload:function(e){console.log(e),function(e,t){for(var n=e.split(","),a=n[0].match(/:(.*?);/)[1],r=atob(n[1]),o=r.length,c=new Uint8Array(o);o--;)c[o]=r.charCodeAt(o);var i=new File([c],t,{type:a});Object(T.saveAs)(i,t)}(e.data.uri,"photo"===e.type?e.data.filename:e.text)},dataSource:l})),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(e){o=e}}))};function A(){var e=Object(p.a)(["\n  display: block;\n  margin: 0 auto;\n  border-color: red;\n"]);return A=function(){return e},e}function N(){var e=Object(p.a)(["\n    subscription getNewMessages($gid: Int!){\n        newMessage(gid: $gid){\n            id\n            content\n            ts\n            sender\n            group\n            cType\n        }\n    }\n"]);return N=function(){return e},e}function P(){var e=Object(p.a)(["\n    query getMessagesForGroup($gid: Int!, $offset: Int, $limit: Int) {\n        messagesByGroup(gid: $gid, count: $limit, offset: $offset){\n            id\n            content\n            ts\n            sender\n            group\n            cType\n        }\n    }\n"]);return P=function(){return e},e}var q=Object(u.gql)(P()),L=Object(u.gql)(N()),U=Object(C.css)(A());var D=function(e){var t=e.selectedGroup,n=e.doneFetching,o=e.setDoneFetching,c=Object(a.useState)([]),i=Object(m.a)(c,2),s=i[0],l=i[1];console.log(t);var p=Object(u.useQuery)(q,{variables:{gid:t,offset:0,limit:50},fetchPolicy:"network"}),g=p.subscribeToMore,f=p.loading,b=p.error,v=p.data,y=p.fetchMore;return Object(a.useEffect)((function(){localStorage.getItem("username");if(console.log(t),v){var e=[].concat(v.messagesByGroup).reverse().map((function(e){return null==localStorage.getItem("".concat(t,"-privateKey"))||"undefined"===localStorage.getItem("".concat(t,"-privateKey"))?null:{sender:e.sender,message:j(e.content,t),senderName:"@".concat(e.sender),cType:e.cType,ts:e.ts}})).filter(Boolean);l(e)}var n=g({document:L,variables:{gid:t},updateQuery:function(e,n){var a=n.subscriptionData;if(!a.data)return o(!0),e;var r=a.data.newMessage,c={sender:r.sender,message:j(r.content,t),senderName:"@".concat(r.sender),cType:r.cType,ts:r.ts};return l((function(e){return[].concat(Object(d.a)(e),[c])})),Object.assign({},e,{messagesByGroup:[r].concat(Object(d.a)(e.messagesByGroup))})}});return function(){n()}}),[g,t,v]),f?r.a.createElement("div",{style:{marginLeft:"10px",marginRight:"10px",marginBottom:"50px"}},r.a.createElement("div",{style:{height:"30px"}},!n&&r.a.createElement(x.a,{css:U,size:30,color:"#123abc",loading:!0}))):b?"Error! ".concat(b.message):r.a.createElement(G,{messages:s,selectedGroup:t,doneFetching:n,onLoadMore:function(){if(!n)return y({variables:{offset:v.messagesByGroup.length},updateQuery:function(e,n){var a=n.fetchMoreResult;0===a.messagesByGroup.length&&o(!0);var r=a.messagesByGroup,c=(localStorage.getItem("username"),r.map((function(e){return null==localStorage.getItem("".concat(t,"-privateKey"))||"undefined"===localStorage.getItem("".concat(t,"-privateKey"))?null:{sender:e.sender,message:j(e.content,t),senderName:"@".concat(e.sender),cType:e.cType,ts:e.ts}})).filter(Boolean));return l((function(e){return[].concat(Object(d.a)(e),Object(d.a)(c))})),Object.assign({},e,{messagesByGroup:[].concat(Object(d.a)(e.messagesByGroup),Object(d.a)(a.messagesByGroup))})}})}})},F=n(115),R=n(408),z=n(401),H=n.n(z),W=(n(651),n(42)),J=n.n(W),Q=n(75),V=n(175),Y=n.n(V);function X(e){return String.fromCharCode.apply(null,Array.from(new Uint8Array(e)))}function Z(e){return _.apply(this,arguments)}function _(){return(_=Object(Q.a)(J.a.mark((function e(t){var n,a,r,o;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.exportKey("spki",t);case 2:return n=e.sent,a=X(n),r=window.btoa(a),o="-----BEGIN PUBLIC KEY-----\n".concat(r,"\n-----END PUBLIC KEY-----"),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(Q.a)(J.a.mark((function e(t){var n,a,r,o;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.exportKey("pkcs8",t);case 2:return n=e.sent,a=X(n),r=window.btoa(a),o="-----BEGIN PRIVATE KEY-----\n".concat(r,"\n-----END PRIVATE KEY-----"),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e,t){return ae.apply(this,arguments)}function ae(){return(ae=Object(Q.a)(J.a.mark((function e(t,n){var a;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:n,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]).then(function(){var e=Object(Q.a)(J.a.mark((function e(n){var a,r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z(n.publicKey);case 2:return a=e.sent,e.next=5,ee(n.privateKey);case 5:return r=e.sent,e.abrupt("return",{privateKey:r,username:t,publicKey:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e){return Y.a.pbkdf2Sync(e,"salt",1,32,"sha512").toString("hex")}function oe(){var e=JSON.stringify(localStorage),t=localStorage.getItem("password")||"";return h.a.AES.encrypt(e,t).toString()}function ce(e,t){var n=h.a.AES.decrypt(e,t);try{for(var a=JSON.parse(n.toString(h.a.enc.Utf8)),r=0,o=Object.entries(a);r<o.length;r++){var c=Object(m.a)(o[r],2),i=c[0],s=c[1];localStorage.setItem(i,s)}}catch(l){return console.error(l),!1}return!0}var ie=n(117),se=n(144);function le(){var e=Object(p.a)(["\n    mutation updateKeys($username: String!, $keys: String!){\n        updateKeys(username:$username, keys:$keys){\n            success\n        }\n    }\n"]);return le=function(){return e},e}function ue(){var e=Object(p.a)(["\n    mutation createPrivateKey($username: String!, $privateKey: String!, $gid: Int!){\n        createPrivateKey(username:$username, gid:$gid, privateKey:$privateKey){\n            id\n            privateKey\n        }\n    }\n"]);return ue=function(){return e},e}function me(){var e=Object(p.a)(["\nmutation createGroup($name: String!, $publicKey: String!, $users: [String!]){\n    createGroup(name:$name, publicKey:$publicKey, users:$users){\n      id\n      name\n      publicKey\n      users{\n          username\n          publicKey\n      }\n    }\n  }\n"]);return me=function(){return e},e}var pe=Object(u.gql)(me()),de=Object(u.gql)(ue()),ge=Object(u.gql)(le());var fe=function(e){var t=e.show,n=e.setShow,o=Object(a.useState)([]),c=Object(m.a)(o,2),i=c[0],s=c[1],l=function(){return n(!1)},p=Object(a.useState)(""),d=Object(m.a)(p,2),g=d[0],f=d[1],b=Object(u.useMutation)(ge),y=Object(m.a)(b,1)[0],h=Object(u.useMutation)(de),O=Object(m.a)(h,1)[0],j=Object(u.useMutation)(pe,{onCompleted:function(e){var t=e.createGroup,n=localStorage.getItem("username"),a=localStorage.getItem("temp-group-privatekey");localStorage.setItem("".concat(t.id,"-privateKey"),a),localStorage.removeItem("temp-group-privatekey"),t.users.map((function(e){var n=function(e,t){var n=new v.a;return n.setPublicKey(t.publicKey),n.encrypt(e)}(a,e);return O({variables:{username:e.username,gid:t.id,privateKey:n}}),!0})),y({variables:{username:n,keys:oe()}}),l()}}),w=Object(m.a)(j,1)[0];return r.a.createElement("div",{style:{backgroundColor:"#2e2e2e"}},r.a.createElement(ie.a,{show:t,transparent:"true",onHide:l},r.a.createElement(ie.a.Header,{closeButton:!0,style:{backgroundColor:"#2e2e2e",borderColor:"#2e2e2e"}},r.a.createElement(ie.a.Title,null,"Input the individuals to add to your new Group Chat!")),r.a.createElement(ie.a.Body,{style:{backgroundColor:"#2e2e2e",borderColor:"#2e2e2e"}},r.a.createElement(H.a,{style:{color:"white"},value:i,onChange:function(e){return s(e)},inputProps:{className:"react-tagsinput-input",placeholder:"Add people!"},onlyUnique:!0}),r.a.createElement(se.a,{style:{marginTop:"20px"}},r.a.createElement(se.a.Group,null,r.a.createElement(se.a.Control,{testid:"createGroupInputField",style:{color:"black"},type:"text",placeholder:"Group Name",value:g,onChange:function(e){return f(e.target.value)}})))),r.a.createElement(ie.a.Footer,{style:{backgroundColor:"#2e2e2e",borderColor:"#2e2e2e"}},r.a.createElement(F.a,{variant:"secondary",onClick:l},"Close"),r.a.createElement(F.a,{variant:"primary",onClick:function(){return function(e,t){e.push(localStorage.getItem("username"));var n=e.filter((function(e,t,n){return n.indexOf(e)===t}));n&&n.length>0?Promise.resolve(ne(t,256)).then((function(e){var a=e.publicKey,r=e.privateKey;localStorage.setItem("temp-group-privatekey",r),w({variables:{users:n,publicKey:a,name:t}})})):console.log("Error, you have no individuals to add to the group")}(i,g)}},"Create Group!"))))};function be(){var e=Object(p.a)(["\n    mutation SendMessage($username: String!, $content: String!, $gid: Int!, $cType: String!){\n        createMessage(sender:$username, group:$gid, content:$content, cType:$cType){\n            id\n            content\n            ts\n        }\n    }\n"]);return be=function(){return e},e}var ve=Object(u.gql)(be()),ye={defaultTheme:{FixedWrapperMaximized:{css:{boxShadow:"0 0 1em rgba(0, 0, 0, 0.1)"}},OwnMessage:Object(l.a)(Object(l.a)({},g.c.OwnMessage),{},{backgroundColor:"#456456",secondaryTextColor:"#456456"})},purpleTheme:Object(l.a)(Object(l.a)({},g.e),{},{TextComposer:Object(l.a)(Object(l.a)({},g.e.TextComposer),{},{css:Object(l.a)(Object(l.a)({},g.e.TextComposer.css),{},{marginTop:"1em"})}),OwnMessage:Object(l.a)(Object(l.a)({},g.e.OwnMessage),{},{secondaryTextColor:"#fff"})}),elegantTheme:Object(l.a)(Object(l.a)({},g.d),{},{Message:Object(l.a)(Object(l.a)({},g.b.Message),{},{secondaryTextColor:"#fff"}),OwnMessage:Object(l.a)(Object(l.a)({},g.b.OwnMessage),{},{secondaryTextColor:"#fff"})}),darkTheme:Object(l.a)(Object(l.a)({},g.b),{},{vars:Object(l.a)(Object(l.a)({},g.b.vars),{},{"tertiary-color":"rgba(40, 40, 40, 0.8)"}),Message:Object(l.a)(Object(l.a)({},g.b.Message),{},{css:Object(l.a)(Object(l.a)({},g.b.Message.css),{},{color:"#fff"})}),OwnMessage:Object(l.a)(Object(l.a)({},g.b.OwnMessage),{},{secondaryTextColor:"#fff"}),TitleBar:Object(l.a)(Object(l.a)({},g.b.TitleBar),{},{css:Object(l.a)(Object(l.a)({},g.b.TitleBar.css),{},{padding:"1em"})})})};var he=function(e){var t=e.client,n=Object(a.useRef)(null),o=localStorage.getItem("username"),c=Object(a.useState)(""),i=Object(m.a)(c,2),s=(i[0],i[1],Object(u.useMutation)(ve)),l=Object(m.a)(s,1)[0],p=Object(a.useState)(null),d=Object(m.a)(p,2),b=d[0],v=d[1],y=Object(a.useState)(!1),h=Object(m.a)(y,2),j=h[0],w=h[1],E=Object(a.useState)(!1),S=Object(m.a)(E,2),k=S[0],K=S[1];return r.a.createElement("div",{className:"main"},r.a.createElement(fe,{show:k,setShow:K}),r.a.createElement(g.a,{theme:ye.darkTheme},r.a.createElement("div",{style:{height:"100%",width:"30%",position:"fixed",zIndex:1,top:0,overflowX:"hidden",paddingTop:"20px",left:0}},r.a.createElement("div",{style:{verticalAlign:"middle",fontSize:24}},r.a.createElement(R.a,{name:o,size:50,round:!0,style:{marginBottom:20,marginLeft:25},title:"@".concat(o)})," ","@".concat(o)),r.a.createElement("div",{className:"App",style:{marginBottom:10}},r.a.createElement(F.a,{variant:"primary",style:{marginRight:"10px"},onClick:function(){return K(!k)}},"Create Group Chat"),r.a.createElement(F.a,{variant:"secondary",onClick:function(){localStorage.clear();var e=window.location.href.split("/");e.pop();var t=e.join("/");window.location.href=t}},"Logout")),r.a.createElement(I,{client:t,selectedGroup:b,setSelectedGroup:v,setDoneFetching:w})),r.a.createElement("div",{style:{height:"100%",width:"70%",position:"fixed",zIndex:1,top:0,overflowX:"hidden",right:0,border:"1px solid rgba(108, 117, 125, 0.1)"}},b&&r.a.createElement(r.a.Fragment,null,r.a.createElement(D,{selectedGroup:b,doneFetching:j,setDoneFetching:w}),r.a.createElement(f.Input,{placeholder:"Enter message",defaultValue:"",ref:n,multiline:!0,onKeyPress:function(e){return!(!e.shiftKey||13!==e.charCode)||(13===e.charCode?(l({variables:{username:o,gid:b,content:O(n.current.input.value,"text",b),cType:"text"}}),n.current.clear(),e.preventDefault(),!1):void 0)},rightButtons:r.a.createElement("input",{id:"raised-button-file",type:"file",onChange:function(e,t){console.log(e.target.files),M(e,b,l,o),e.preventDefault()}})})))))},Oe=n(185),je=n(4),we=n(186);var Ee=function(){var e=window.location.href.includes("https://rithik.me/"),t=e?"https://e2-chat.herokuapp.com":"http://localhost:4000",n=e?"wss://e2-chat.herokuapp.com":"ws://localhost:4000",a=localStorage.getItem("token"),o=Object(u.createHttpLink)({uri:"".concat(t,"/graphql")}),c=Object(Oe.a)((function(e,t){var n=t.headers;return{headers:Object(l.a)(Object(l.a)({},n),{},{authorization:a?"".concat(a):""})}})),i=new we.a({uri:"".concat(n,"/graphql"),options:{reconnect:!0,connectionParams:{Authorization:a}}}),s=Object(u.split)((function(e){var t=e.query,n=Object(je.p)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),i,c.concat(o)),m=new u.ApolloClient({link:s,cache:new u.InMemoryCache});return r.a.createElement(u.ApolloProvider,{client:m},r.a.createElement("div",null,r.a.createElement(he,{client:m})))},Se=n(734),ke=n(738),Ke=n(739),Ie=n(737),Ce=n(736),$e=n(262),xe=n.n($e),Te=n(409),Me=n(261),Be=n(735),Ge=n(407),Ae=n(730);function Ne(){var e=Object(p.a)(["\n    mutation updateKeys($username: String!, $keys: String!){\n        updateKeys(username:$username, keys:$keys){\n            success\n        }\n    }\n"]);return Ne=function(){return e},e}function Pe(){var e=Object(p.a)(["\n\tquery User($username: String!){\n\t\tuser(username:$username){\n\t\t\tusername\n\t\t\tid\n\t\t\tkeys\n\t\t}\n\t}\n"]);return Pe=function(){return e},e}function qe(){var e=Object(p.a)(["\n\tmutation CreateToken($username: String!, $publicKey: String!){\n\t\t  createToken(username:$username, publicKey:$publicKey){\n\t\t    token\n\t\t    username\n\t\t}\n\t}\n"]);return qe=function(){return e},e}function Le(){var e=Object(p.a)(["\n\tmutation CreateUser($username: String!, $publicKey: String!){\n\t  createUser(username:$username, publicKey:$publicKey){\n\t    id\n\t    username\n\t    publicKey\n\t  }\n\t}\n"]);return Le=function(){return e},e}var Ue=Object(Ge.a)({overrides:{MuiFormLabel:{root:{color:"white",borderColor:"white"}},MuiOutlinedInput:{root:{"& $notchedOutline":{borderColor:"rgba(255, 255, 255, 0.23)"},"&:hover:not($disabled):not($focused):not($error) $notchedOutline":{borderColor:"#4A90E2","@media (hover: none)":{borderColor:"rgba(255, 255, 255, 0.23)"}},"&$focused $notchedOutline":{borderColor:"#4A90E2",borderWidth:1}}},MuiInput:{input:{"&::placeholder":{color:"gray"},color:"white"}}}}),De=Object(u.gql)(Le()),Fe=Object(u.gql)(qe()),Re=Object(u.gql)(Pe()),ze=Object(u.gql)(Ne());var He=function(){var e=Object(u.useMutation)(ze),t=Object(m.a)(e,1)[0],n=Object(u.useMutation)(De,{onCompleted:function(e){var t=e.createUser,n=t.username,a=t.publicKey;i({variables:{username:n,publicKey:a}})}}),o=Object(m.a)(n,1)[0],c=Object(u.useMutation)(Fe,{onCompleted:function(e){var n=e.createToken,a="login"===F?K:y;localStorage.setItem("token",n.token),localStorage.setItem("username",n.username),localStorage.setItem("password",re(a)),t({variables:{username:n.username,keys:oe()}}),window.location.href=window.location.href+"main"}}),i=Object(m.a)(c,1)[0],s=Object(u.useMutation)(Fe,{onCompleted:function(e){var t=e.createToken;localStorage.setItem("token",t.token),window.location.href=window.location.href+"main"}}),l=Object(m.a)(s,1)[0],p=Object(a.useState)(""),d=Object(m.a)(p,2),g=d[0],f=d[1],b=Object(a.useState)(""),v=Object(m.a)(b,2),y=v[0],h=v[1],O=Object(a.useState)(""),j=Object(m.a)(O,2),w=j[0],E=j[1],S=Object(a.useState)(""),k=Object(m.a)(S,2),K=k[0],I=k[1],C=Object(a.useState)(!1),$=Object(m.a)(C,2),x=$[0],T=$[1],M=Object(a.useState)(!1),B=Object(m.a)(M,2),G=B[0],A=B[1],N=Object(a.useState)(!1),P=Object(m.a)(N,2),q=P[0],L=P[1],U=Object(a.useState)("login"),D=Object(m.a)(U,2),F=D[0],R=D[1],z=Object(u.useQuery)(Re,{variables:{username:"login"===F?w:g}}),H=z.error,W=z.refetch,V=function(){var e=Object(Q.a)(J.a.mark((function e(t){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="login"===F?w:g,Promise.resolve(ne(t,4096)).then((function(e){var t=e.publicKey,a=e.privateKey;o({variables:{username:n,publicKey:t}}),localStorage.setItem("user-publicKey",t),localStorage.setItem("user-privateKey",a),localStorage.setItem("username",n)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=function(){var e=Object(Q.a)(J.a.mark((function e(){var t,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W({username:g});case 2:t=e.sent,n=t.data,H?V(g):null==n.user?(T(!1),V(g)):(T(!0),L(!1));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=Object(Q.a)(J.a.mark((function e(){var t,n,a,r,o;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W({username:w});case 2:t=e.sent,n=t.data,console.log(n),H?(console.error(H),A(!0),L(!1)):null===n.user?(A(!0),L(!1)):(a=re(K),ce(n.user.keys,a)?(r=localStorage.getItem("username"),o=localStorage.getItem("user-publicKey"),l({variables:{username:r,publicKey:o}})):(A(!0),L(!1)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(Ae.a,{theme:Ue},r.a.createElement(Te.a,{fill:!0,id:"controlled-tab-example",className:"tabHeadings",activeKey:F,onSelect:function(e){return R(e)}},r.a.createElement(Me.a,{eventKey:"login",title:"Login"},r.a.createElement("div",{className:"register"},r.a.createElement(ke.a,{InputProps:{style:{color:"white"}},id:"outlined-basic",label:"Username",variant:"outlined",value:w,color:"secondary",fullWidth:!0,onChange:function(e){return E(e.target.value)}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(ke.a,{InputProps:{style:{color:"white"}},id:"outlined-basic",label:"Password",variant:"outlined",value:K,type:"password",color:"secondary",fullWidth:!0,onChange:function(e){return I(e.target.value)}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Se.a,{disabled:q,onClick:function(e){e.preventDefault(),L(!0),X()},variant:"contained",color:"secondary"},q&&r.a.createElement(Be.a,{size:20,style:{color:"white",marginRight:"10px"}})," Login"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Ce.a,{in:G},r.a.createElement(Ke.a,{action:r.a.createElement(Ie.a,{"aria-label":"close",color:"inherit",size:"small",onClick:function(){A(!1)}},r.a.createElement(xe.a,{fontSize:"inherit"})),variant:"filled",severity:"error"},"Invalid Login")))),r.a.createElement(Me.a,{eventKey:"register",title:"Register"},r.a.createElement("div",{className:"register"},r.a.createElement(ke.a,{InputProps:{style:{color:"white"}},id:"outlined-basic",label:"Username",variant:"outlined",value:g,color:"secondary",fullWidth:!0,onChange:function(e){return f(e.target.value)}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(ke.a,{InputProps:{style:{color:"white"}},id:"outlined-basic",label:"Password",variant:"outlined",value:y,type:"password",color:"secondary",fullWidth:!0,onChange:function(e){return h(e.target.value)}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Se.a,{disabled:q,onClick:function(e){e.preventDefault(),L(!0),Y()},variant:"contained",color:"secondary"},q&&r.a.createElement(Be.a,{size:20,style:{color:"white",marginRight:"10px"}})," Register"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Ce.a,{in:x},r.a.createElement(Ke.a,{action:r.a.createElement(Ie.a,{"aria-label":"close",color:"inherit",size:"small",onClick:function(){T(!1)}},r.a.createElement(xe.a,{fontSize:"inherit"})),variant:"filled",severity:"error"},"Invalid username - choose a unique username"))))))};var We=function(){var e=window.location.href.includes("https://rithik.me/"),t=e?"https://e2-chat.herokuapp.com":"http://localhost:4000",n=e?"wss://e2-chat.herokuapp.com":"ws://localhost:4000",a=localStorage.getItem("token"),o=Object(u.createHttpLink)({uri:"".concat(t,"/graphql")}),c=Object(Oe.a)((function(e,t){var n=t.headers;return{headers:Object(l.a)(Object(l.a)({},n),{},{authorization:a?"".concat(a):""})}})),i=new we.a({uri:"".concat(n,"/graphql"),options:{reconnect:!0,connectionParams:{Authorization:a}}}),s=Object(u.split)((function(e){var t=e.query,n=Object(je.p)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),i,c.concat(o)),m=new u.ApolloClient({link:s,cache:new u.InMemoryCache});return r.a.createElement(u.ApolloProvider,{client:m},r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement(He,null))))};var Je=function(){return r.a.createElement(i.a,{basename:"/"},r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/main"},r.a.createElement(Ee,null)),r.a.createElement(s.a,{path:"/"},r.a.createElement(We,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.Fragment,null,r.a.createElement(Je,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},86:function(e,t,n){}},[[420,1,2]]]);
//# sourceMappingURL=main.1ad73f5d.chunk.js.map